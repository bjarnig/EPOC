
BGenLitharge : BGen
{
	var paramValues, reverb, effectBus, <>isPlaying, preControl, <>durations, <>amplitudes, <>noiseType;

	*new { |id=0, description, duration=10, control, outBus=0, values, durations, amplitudes, noiseType=1, load=1|
		^super.newCopyArgs(id, description, duration, control, outBus, nil, values, durations, amplitudes, noiseType).init(load);
	}

	init {|load=1|
		this.setDescription;
		this.isPlaying = 0;
		preControl = BControl.new;
		if(this.control.isNil, {this.control = BControl.new});

		if(load > 0, {

		this.initEffect.value;
		if(durations.isNil, {durations = [0.5, 1, 0.5, 2, 4, 0.5, 1]});
		if(amplitudes.isNil, {amplitudes = [1.0, 0.1, 0.8, 0.2, 0.4, 1.0, 0.1, 1.0]});

		});
	}

	initEffect {
		effectBus = Bus.audio(Server.local, 2);
		reverb = Bwrap.new(\lithargeVerb, [\in, effectBus, \out, outBus]);
		reverb.play;
	}

	setParam {|paramName, paramValue|
		if(paramName == \duration, {duration = paramValue});
		if(paramName == \durations, {durations = paramValue});
		if(paramName == \amplitudes, {amplitudes = paramValue});
		if(paramName == \noiseType, {noiseType = paramValue});
		if(paramName == \outBus, {outBus = paramValue});
	}

	*loadSynthDefs {

	 	SynthDef(\litharge,
		{| out=0, amp=0.5, atk=0.5, sus=10, rel=0.1, surface=0.0, speed=0.001, density=0.5, entropy=0.0, lop=10000, hip=10000, pan=0,
		envTime=1, dustSpeed=100, crackleSpeed,
		brownAmt=1.0, whiteAmt=1.0, pinkAmt=1.0, dustAmt=1.0, durations=#[0.5, 1, 0.5, 2, 4, 0.5, 1], amplitudes=#[0.1, 1.0, 0.4, 0.8, 1.0, 0.1, 0.7, 0.1]|
	 	var env = EnvGen.kr(Env.new([0,1,1,0], [atk,sus,rel], -2), doneAction:2);
	 	var signal = (WhiteNoise.ar(whiteAmt) + PinkNoise.ar(brownAmt) + Crackle.ar(crackleSpeed, mul:pinkAmt) + Dust.ar(dustSpeed, mul:dustAmt)) * 0.5;
		var mod = (signal * LFNoise1.ar(32 * speed) * entropy);
		signal = (signal * (1 - entropy)) + mod;
	 	signal = (RLPF.ar(signal, lop, 1.15) * (1-surface)) + (RHPF.ar(signal, hip, 1.15) * surface);
	 	signal = signal * EnvGen.kr(Env.new(amplitudes, durations).circle, timeScale:envTime);
	 	signal = Limiter.ar(signal * 1.8, 0.99, 0.05);
	 	signal = Pan2.ar(signal, pan, env * amp);
		Out.ar(out, signal);
		}, [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
		).add;

		SynthDef(\lithargeVerb,{| in = 3, out = 0, amp=1.0, mix=0.5, decay=1.0, density=0.25, fund=60, randMin=1.0, randMax=1.0|
